#!/bin/bash
set -e

if [ -d /run/user/0 ] || mkdir -p /run/user/0 -m 700; then
  # This works on Ubuntu Core
  export XDG_RUNTIME_DIR=/run/user/0
else
  # This works on Ubuntu Classic
  if [ ! -d "$XDG_RUNTIME_DIR" ]; then
    mkdir -p $XDG_RUNTIME_DIR -m 700
  fi
fi

if [ ! -d "$XDG_CACHE_HOME" ]; then
  mkdir -p $XDG_CACHE_HOME
fi

# Make PulseAudio socket available inside the snap-specific $XDG_RUNTIME_DIR
pulsenative="pulse/native"
pulseaudio_sockpath="$XDG_RUNTIME_DIR/$pulsenative"
if [ -S "$pulseaudio_sockpath" ]; then
    export PULSE_SERVER="unix:${pulseaudio_sockpath}"
fi

## gnome-chess
#if [ ! -f "$XDG_CONFIG_HOME/gnome-chess/engines.conf" ]; then
#    mkdir -p $XDG_CONFIG_HOME/gnome-chess
#    cp $SNAP/config/gnome-chess/engines.conf $XDG_CONFIG_HOME/gnome-chess
#fi

cd $HOME
unset DISPLAY # How does this get set?!
#dbus-run-session -- $SNAP/bin/egmde $@
$SNAP/bin/egmde $@

